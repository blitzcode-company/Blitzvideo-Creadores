<app-header></app-header>
<div class="containerHome" [class.collapsed]="sidebarCollapsed$ | async">
  <div class="sidebar-container">
    <div class="sidebar" *ngIf="canalNombre">
      <div class="profile-section">
        <img *ngIf="!usuario?.foto" class="fotoPerfilDefault" src="assets/images/user.png" alt="Perfil">
        <img *ngIf="usuario?.foto" class="fotoPerfil" [src]="usuario.foto" alt="Perfil">
        <h1 class="channel-name">{{ canalNombre }}</h1>
      </div>
      <hr class="lineaSideBar">
      <nav class="menu-nav">
        <a class="menu-item active" routerLink="/misVideos">
          <mat-icon>video_library</mat-icon>
          <span>Mis videos</span>
        </a>
        <a class="menu-item" routerLink="/subirVideo">
          <mat-icon>cloud_upload</mat-icon>
          <span>Subir video</span>
        </a>
        <a class="menu-item" routerLink="/crearStream">
          <mat-icon>live_tv</mat-icon>
          <span>Crear stream</span>
        </a>
      </nav>
    </div>
  </div>

  <div class="content-wrapper">
    <div class="videos-container">
      <div *ngIf="videos.length === 0" class="no-videos">
        <mat-icon>video_library</mat-icon>
        <h2>No tienes videos subidos</h2>
        <p>¡Sube tu primer video!</p>
        <a mat-raised-button color="primary" routerLink="/subirVideo">
          <mat-icon>cloud_upload</mat-icon>
          Subir video
        </a>
      </div>

      <div class="videos-list-container" *ngIf="videos.length > 0">
  <div class="selection-toolbar" *ngIf="videosSeleccionados.size > 0">
    <div class="selection-info">
      <mat-icon>check_circle</mat-icon>
      <span>{{ videosSeleccionados.size }} video{{ videosSeleccionados.size !== 1 ? 's' : '' }} seleccionado{{ videosSeleccionados.size !== 1 ? 's' : '' }}</span>
    </div>
    <div class="selection-actions">
      <button mat-raised-button color="primary" (click)="abrirModalPlaylists()">
        <mat-icon>playlist_add</mat-icon>
        Agregar a playlist
      </button>
      <button mat-raised-button color="warn" (click)="eliminarVideosSeleccionados()">
        <mat-icon>delete</mat-icon>
        Eliminar seleccionados
      </button>
      <button mat-button (click)="limpiarSeleccion()">
        <mat-icon>clear</mat-icon>
        Limpiar selección
      </button>
    </div>
  </div>

  <div class="list-header">
    <div class="col-checkbox">
      <mat-checkbox [checked]="todosSeleccionados" 
                    [indeterminate]="videosSeleccionados.size > 0 && !todosSeleccionados"
                    (change)="toggleSeleccionTodos()">
      </mat-checkbox>
    </div>
    <div class="col-thumbnail">Miniatura</div>
    <div class="col-title">Título</div>
    <div class="col-visibility">Visibilidad</div>
    <div class="col-date">Fecha</div>
    <div class="col-views">Vistas</div>
    <div class="col-actions">Acciones</div>
  </div>

  <div class="video-row" *ngFor="let video of videos" [class.selected]="isVideoSeleccionado(video.id)">
    <div class="col-checkbox">
      <mat-checkbox [checked]="isVideoSeleccionado(video.id)"
                    (change)="toggleSeleccionVideo(video.id)">
      </mat-checkbox>
    </div>

    <div class="col-thumbnail">
      <a [href]="serverIp + '3001/video/' + video.id" target="_blank">
        <img [src]="video.miniatura" 
             (error)="onImageError($event)" 
             alt="Miniatura">
        <span class="duration">{{ video.duracion || '3:45' }}</span>
      </a>
    </div>

    <div class="col-title">
      <a [routerLink]="['/editarVideo', video.id]" target="_blank" class="video-title-link">
        {{ video.titulo }}
      </a>
      <p class="video-description-preview">{{ video.descripcion | slice:0:100 }}{{ video.descripcion.length > 100 ? '...' : '' }}</p>
    </div>

    <div class="col-visibility">
      <mat-chip [color]="video.publicado ? 'primary' : 'warn'" selected>
        {{ video.acceso ? 'Público' : 'Privado' }}
      </mat-chip>
    </div>

    <div class="col-date">
      {{ video.created_at | tiempo }}
    </div>

    <div class="col-views">
      {{ video.visitas_count | number }}
    </div>

    <div class="col-actions">
      <button mat-icon-button [routerLink]="['/editarVideo', video.id]" 
              matTooltip="Editar video">
        <mat-icon>edit</mat-icon>
      </button>
      <button mat-icon-button color="warn" 
              (click)="eliminarVideo(video.id)" 
              matTooltip="Eliminar">
        <mat-icon>delete</mat-icon>
      </button>
      <button mat-icon-button matTooltip="Más opciones">
        <mat-icon>more_vert</mat-icon>
      </button>
    </div>
  </div>
</div>
    </div>
  </div>
</div>

<div *ngIf="!canalNombre" class="no-access">
  <mat-icon>lock</mat-icon>
  <h2>No tienes canal</h2>
  <p>Crea un canal para ver tus videos</p>
  <a mat-button [routerLink]="['/crearCanal']">Crear canal</a>
</div>