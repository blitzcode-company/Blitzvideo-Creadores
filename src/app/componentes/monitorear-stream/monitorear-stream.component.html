<app-header></app-header>

<div class="stream-dashboard" *ngIf="!cargando && stream">

  <div class="stream-header">
    <h2>{{ stream.titulo }}</h2>
    <span [ngClass]="stream.activo === 1 ? 'activo' : 'inactivo'">
      {{ stream.activo === 1 ? '游릭 En vivo' : '游댮 Esperando transmisi칩n' }}
    </span>
  </div>

  <div class="dashboard-container">
    <div class="video-wrapper">
      <video #videoPlayer controls *ngIf="stream.activo === 1"></video>
      <div *ngIf="stream.activo !== 1" class="esperando">
        <p>La transmisi칩n a칰n no ha comenzado.</p>
      </div>
    </div>

    <div class="right-panel">

      <div class="metrics-panel">
        <div class="metric">
          <span class="metric-label">Viewers</span>
          <span class="metric-value">{{ stream.viewers || 0 }}</span>
        </div>
        <div class="metric">
          <span class="metric-label">Comentarios</span>
          <span class="metric-value">{{ chatMessagesList.length }}</span>
        </div>
  
      </div>

      <div class="monitor-panel">
        <h3>Chat de monitoreo</h3>
        <div #chatMessages class="chat-messages">
          <div *ngFor="let msg of chatMessagesList" class="chat-message" [ngClass]="{'my-message': msg.userId === userId}">
            <img 
              [src]="msg.user_photo" 
              alt="{{ msg.user }}" 
              class="avatar"
              (error)="onImageError($event)" />
            <div class="message-bubble">
              <span class="username">{{ msg.user }}</span>
              <span class="text">{{ msg.text }}</span>
              <span class="timestamp">{{ msg.created_at | date:'HH:mm' }}</span>
            </div>
          </div>
        </div>

        <div class="chat-input-container">
          <form (submit)="enviarMensaje(); $event.preventDefault()" class="chat-input-form">
            <input [(ngModel)]="mensaje" name="mensaje" class="chat-input" placeholder="Escribe un mensaje..." required>
            <button type="submit" class="chat-send-btn">Enviar</button>
          </form>
        </div>
      </div>

    </div>
  </div>

  <!-- Descripci칩n del stream -->
  <div class="descripcion-wrapper">
    <p class="descripcion">{{ stream.descripcion }}</p>
  </div>
</div>
