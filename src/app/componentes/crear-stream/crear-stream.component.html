<app-header></app-header>
<div class="containerHome" [class.collapsed]="sidebarCollapsed$ | async">
  <div class="sidebar-container">
    <div class="sidebar" *ngIf="canalNombre">
      <div class="profile-section">
        <img *ngIf="!usuario?.foto" class="fotoPerfilDefault" src="assets/images/user.png" alt="Perfil">
        <img *ngIf="usuario?.foto" class="fotoPerfil" [src]="usuario.foto" alt="Perfil">
        <h1 class="channel-name">{{ canalNombre }}</h1>
      </div>
      <hr class="lineaSideBar">
      <nav class="menu-nav">
        <a class="menu-item" routerLink="/misVideos">
          <mat-icon>video_library</mat-icon>
          <span>Mis videos</span>
        </a>
        <a class="menu-item" routerLink="/subirVideo">
          <mat-icon>cloud_upload</mat-icon>
          <span>Subir video</span>
        </a>
        <a class="menu-item active" routerLink="/crearStream">
          <mat-icon>live_tv</mat-icon>
          <span>Crear stream</span>
        </a>
      </nav>
    </div>
  </div>

  <div class="content-wrapper">
    <div class="form-container-stream">
      <div class="form-header">
        <h2><mat-icon>live_tv</mat-icon> Crear nueva transmisión</h2>
      </div>
      
      <div class="form-content-stream">
        <form [formGroup]="streamForm" (ngSubmit)="crearStream()">
          
          <div class="form-group-stream">
            <mat-form-field appearance="outline" class="stream-field">
              <mat-label>Título del stream</mat-label>
              <input matInput formControlName="titulo" required>
            </mat-form-field>
          </div>

          <div class="form-group-stream">
            <mat-form-field appearance="outline" class="stream-field">
              <mat-label>Descripción</mat-label>
              <textarea matInput formControlName="descripcion" rows="4" required></textarea>
            </mat-form-field>
          </div>

          <div class="upload-section-stream">
            <label class="upload-label-stream">
              <mat-icon>photo_camera</mat-icon>
              Miniatura del stream (1280x720 recomendada)
              <input type="file" (change)="onFileSelected($event)" accept="image/*" class="hidden-file">
            </label>
            <img *ngIf="thumbnailPreview" [src]="thumbnailPreview" class="thumbnail-preview-stream">
          </div>

          <mat-progress-bar *ngIf="uploadProgress > 0" 
                            mode="determinate" 
                            [value]="uploadProgress"
                            class="stream-progress"></mat-progress-bar>

          <div class="form-actions-stream">
            <button mat-raised-button 
                    color="primary" 
                    type="submit" 
                    [disabled]="streamForm.invalid || uploading">
              <mat-icon>live_tv</mat-icon>
              {{ uploading ? 'Creando... ' + uploadProgress + '%' : 'Crear stream' }}
            </button>
          </div>
        </form>
      </div>
    </div>
  </div>
</div>

<div *ngIf="!canalNombre" class="no-access">
  <mat-icon>lock</mat-icon>
  <h2>No tienes canal</h2>
  <p>Crea un canal para transmitir</p>
  <a mat-button [routerLink]="['/crearCanal']">Crear canal</a>
</div>